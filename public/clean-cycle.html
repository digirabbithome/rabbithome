<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>🧹 環境整理（甜甜圈貢獻度｜雲端）</title>
  <link rel="icon" href="/img/rabbit-ico.png" />
  <link rel="stylesheet" href="css/clean-cycle.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.6/dist/chart.umd.min.js"></script>
  <script type="module" src="js/clean-cycle.js?v=1.6.9-20251004-1106"></script>
</head>
<body>
  <div class="page">
    <header class="topbar">
      <div class="left">
        <h1>🧹 環境整理（週期管理）<span class="ver">v1.6.9-20251004-1106</span></h1>
        <span class="tag">暱稱＆資料皆走 Firebase</span>
      </div>
      <div class="right">
        <label class="nick">
          執行人暱稱
          <input id="nickname" placeholder="由帳號帶出" disabled />
        </label>
        <button id="openAdd" class="btn">＋新增項目</button>
        <button id="checkAllDue" class="btn ghost">一鍵完成「到期」</button>
        <button id="exportCSV" class="btn ghost">匯出 CSV</button>
      </div>
    </header>

    <section class="controls">
      <div class="filters">
        <button data-filter="all" class="chip active">全部</button>
        <button data-filter="overdue" class="chip">需要清潔</button>
        <button data-filter="soon" class="chip">等待清潔(≤2天)</button>
        <button data-filter="ok" class="chip">完成清潔</button>
        <button data-filter="done-today" class="chip">今日已完成</button>
      </div>
      <div class="stats">
        <span>總數：<b id="totalCount">0</b></span>
        <span>需要清潔：<b id="overCount">0</b></span>
        <span>等待清潔：<b id="dueCount">0</b></span>
        <span>今日已完成：<b id="doneToday">0</b></span>
        <span class="muted" id="lastSaved">已連線 Firebase</span>
      </div>
    </section>

    <section id="list" class="list"></section>

    <section id="chart" class="chart card">
      <h3>🌟 同事貢獻度統計（甜甜圈圖）<span id="chartMonthLabel" class="meta" style="margin-left:8px"></span></h3>
      <div class="donut-wrapper">
        <canvas id="contribChart" width="300" height="300"></canvas>
        <div id="donutCenterText">本月完成 0 次</div>
      </div>
    </section>
  </div>

  <dialog id="taskDlg">
    <form method="dialog" class="dlg">
      <h3 id="dlgTitle">新增項目</h3>
      <div class="grid" id="dlgGrid">
        <label>區域
          <input id="fArea" placeholder="如：前場 / 倉庫 / 廁所" />
        </label>
        <label>項目名稱
          <input id="fName" placeholder="如：掃地、拖地、垃圾桶…" />
        </label>
        <label>週期（天）
          <input id="fDays" type="number" min="1" value="7" />
        </label>
        <!-- 編輯時才會插入「上次完成」欄位 -->
        <div id="editOnlySlot"></div>
        <label>備註
          <input id="fNote" placeholder="清潔劑 / 注意事項" />
        </label>
      </div>
      <menu>
        <button value="cancel" class="btn ghost">取消</button>
        <button id="saveTask" value="default" class="btn primary">儲存</button>
      </menu>
    </form>
  </dialog>
</body>
</html>
