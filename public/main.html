
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>Rabbithome ä¸»é </title>
  <script type="module" src="/js/main.js"></script>
  <link rel="stylesheet" href="/css/style.css" />
</head>
<body>
  <div class="flex h-screen">
    <!-- å´é‚Šæ¬„ -->
    <div class="w-64 bg-white p-4 shadow-md">
      <div class="text-2xl font-bold text-pink-500 mb-4">ğŸ™‹â€â™‚ï¸ Helloï¼Œ<span id="nickname">ä½¿ç”¨è€…</span></div>

      <div id="sidebar-buttons" class="space-y-4">
        <button class="sidebar-btn" onclick="showSection('daily-work')">ğŸ“‹ æ¯æ—¥å·¥ä½œ</button>
        <button class="sidebar-btn" onclick="showSection('work-progress')">ğŸ—‚ï¸ å·¥ä½œé€²åº¦</button>
        <button class="sidebar-btn" onclick="showSection('print-envelope')">âœ‰ï¸ åˆ—å°ä¿¡å°</button>
        <button class="sidebar-btn" onclick="showSection('add-account')">ğŸ‘¤ æ–°å¢å¸³è™Ÿ</button>
        <button class="sidebar-btn" onclick="showSection('member-management')">ğŸ‘¥ æœƒå“¡ç®¡ç†</button>
        <button class="sidebar-btn" onclick="logout()">ğŸšª ç™»å‡º</button>
      </div>
    </div>

    <!-- ä¸»å…§å®¹å€ -->
    <div class="flex-1 p-10">
      <div id="daily-work" class="content-section">é€™è£¡æ˜¯æ¯æ—¥å·¥ä½œå€åŸŸ</div>
      <div id="work-progress" class="content-section hidden">é€™è£¡æ˜¯å·¥ä½œé€²åº¦å€åŸŸ</div>
      <div id="print-envelope" class="content-section hidden">é€™è£¡æ˜¯åˆ—å°ä¿¡å°å€åŸŸ</div>
      <div id="add-account" class="content-section hidden">
        <h2 class="text-xl font-bold mb-4">æ–°å¢å¸³è™Ÿ</h2>
        <form id="addAccountForm" class="space-y-4">
          <input type="email" id="newEmail" placeholder="Email" class="input" required />
          <input type="text" id="newNickname" placeholder="æš±ç¨±" class="input" required />
          <input type="text" id="newName" placeholder="å§“å" class="input" required />
          <input type="text" id="newBirthday" placeholder="ç”Ÿæ—¥ï¼ˆå¦‚ 1990/01/01ï¼‰" class="input" required />
          <input type="password" id="newPassword" placeholder="å¯†ç¢¼" class="input" required />
          <select id="newGroup" class="input">
            <option value="å¤–å ´">å¤–å ´</option>
            <option value="å…§å ´">å…§å ´</option>
            <option value="ç¾ç·¨">ç¾ç·¨</option>
            <option value="å‡ºè²¨">å‡ºè²¨</option>
          </select>
          <button type="submit" class="btn">é€å‡º</button>
        </form>
        <p id="addAccountMessage" class="mt-2 text-green-600"></p>
      </div>
      <div id="member-management" class="content-section hidden">é€™è£¡æ˜¯æœƒå“¡ç®¡ç†å€åŸŸ</div>
    </div>
  </div>

  <script type="module">
    import { auth, db } from '/js/firebase.js';
    import { signOut } from 'https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js';
    import { doc, setDoc } from 'https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js';

    document.addEventListener("DOMContentLoaded", () => {
      const user = JSON.parse(localStorage.getItem("user"));
      if (user?.nickname) {
        document.getElementById("nickname").textContent = user.nickname;
      }

      window.showSection = function (sectionId) {
        document.querySelectorAll(".content-section").forEach(sec => sec.classList.add("hidden"));
        const target = document.getElementById(sectionId);
        if (target) target.classList.remove("hidden");
      };

      window.logout = function () {
        signOut(auth).then(() => {
          localStorage.removeItem("user");
          window.location.href = "login.html";
        });
      };

      const addForm = document.getElementById("addAccountForm");
      if (addForm) {
        addForm.addEventListener("submit", async (e) => {
          e.preventDefault();
          const email = document.getElementById("newEmail").value;
          const nickname = document.getElementById("newNickname").value;
          const name = document.getElementById("newName").value;
          const birthday = document.getElementById("newBirthday").value;
          const password = document.getElementById("newPassword").value;
          const group = document.getElementById("newGroup").value;

          try {
            const uid = Date.now().toString();
            await setDoc(doc(db, "users", uid), {
              email, nickname, name, birthday, password, group
            });
            document.getElementById("addAccountMessage").textContent = "âœ… å¸³è™Ÿæ–°å¢æˆåŠŸï¼";
            addForm.reset();
          } catch (err) {
            document.getElementById("addAccountMessage").textContent = "âŒ éŒ¯èª¤ï¼š" + err.message;
          }
        });
      }
    });
  </script>
</body>
</html>
