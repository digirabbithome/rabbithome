<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>å·¥ä½œç´€éŒ„ï½œRabbithome</title>
  <link rel="stylesheet" href="/css/daily-report.css?v=2.16" />
  <script type="module" src="/js/daily-report.js?v=2.16"></script>
</head>
<body>
  <div class="dr-wrap">
    <aside class="dr-sidebar" id="dailyPane">
      
      
      <div class="dr-block">
        <iframe id="dailyFrame" class="dr-iframe" src="/daily-embed.html#embed"></iframe>
      </div>
    </aside>

<main class="dr-main">

      <div class="dr-topbar">
        <div class="dr-topbar-right">
          <span class="dr-range">æœŸé–“ï¼š<span id="rangeText">â€”</span></span>
          <span class="dr-whoami">ç™»å…¥ï¼š<span id="whoami">â€”</span></span>
          <div class="dr-topbar-controls">
            <label class="dr-inline"><input id="viewMine" type="radio" name="viewScope" value="mine" /> åªçœ‹æˆ‘çš„</label>
            <label class="dr-inline"><input id="viewAll" type="radio" name="viewScope" value="all" checked /> å…¨éƒ¨</label>
            <input id="searchInput" type="search" class="dr-input dr-input-compact" placeholder="ğŸ” æœ€è¿‘60å¤©æœå°‹â€¦" />
          </div>
        </div>
      </div>

      <section class="dr-editor-card">
        <header class="dr-editor-head">
          <div class="dr-title-left">
            <h1 class="dr-page-title">ä»Šæ—¥å·¥ä½œ</h1>
            <div class="dr-sub">ä»Šå¤©ï¼š<span id="todayLabel">â€”</span></div>
          </div>
          <div class="dr-title-right">
            <input id="reportTitle" class="dr-title-input" placeholder="ä»Šæ—¥æ¨™é¡Œï¼ˆå¯ä¸å¡«ï¼‰" />
            <button id="btnSave" class="dr-btn dr-btn-primary">ğŸ’¾ å„²å­˜/æ›´æ–°ä»Šå¤©</button>
<button id="btnGoProgress" class="dr-btn dr-btn-secondary">ğŸ“Š å·¥ä½œé€²åº¦</button>
          </div>
        </header>

        <div class="dr-toolbar">
          <button id="btnBold" data-cmd="bold" title="ç²—é«” (Ctrl/Cmd+B)"><b>B</b></button>
          <button id="btnItalic" data-cmd="italic" title="æ–œé«” (Ctrl/Cmd+I)"><i>I</i></button>
          <button id="btnUnderline" data-cmd="underline" title="åº•ç·š (Ctrl/Cmd+U)"><u>U</u></button>
          <span class="sep"></span>
          <label class="colorpick"><span>å­—è‰²</span><input id="foreColor" type="color" value="#111111" /></label>
          <label class="colorpick"><span>åº•è‰²</span><input id="backColor" type="color" value="#fff59d" /></label>
          <span class="sep"></span>
          <button id="btnUndo" title="å¾©åŸ (Ctrl/Cmd+Z)">â†¶ Undo</button>
          <button id="btnRedo" title="é‡åš (Ctrl/Cmd+Y / Shift+Ctrl+Z)">â†· Redo</button>
          <span class="sep"></span>
          <button id="btnClear">æ¸…é™¤æ ¼å¼</button>
        </div>

        <div id="editor" class="dr-editor" contenteditable="true"></div>
        <div class="dr-tip">æç¤ºï¼šé¸å–æ–‡å­—å³å¯è®Šæ›´å­—è‰²/åº•è‰²ï¼›æ”¯æ´ Ctrl/Cmd + B/U/I èˆ‡ Undo/Redoã€‚</div>
      </section>

      <section id="recordsSection">
        <h2 class="dr-list-title">å·¥ä½œç´€éŒ„ï¼ˆæœ€è¿‘ 60 å¤©ï¼‰</h2>
        <ul id="reportList" class="dr-list"></ul>
      </section>
    </main>
  </div>

  <div id="toast" class="toast" hidden></div>

<script type="module">
// === ç›£è½å·¦é‚Š daily.html å‚³ä¾†çš„è¨Šæ¯ ===
window.addEventListener('message', (e) => {
  if (!e?.data || e.data.type !== 'workReports:updated') return
  refreshRightPanels()
})

// åŒçª—äº‹ä»¶ï¼ˆè‹¥ daily-report èˆ‡ daily åœ¨åŒçª—æ™‚ä¹Ÿèƒ½è§¸ç™¼ï¼‰
window.addEventListener('workReports:updated', () => {
  refreshRightPanels()
})

// === å³å´åˆ·æ–°å‡½å¼ ===
// ä¾ä½ çš„ daily-report.js å¯¦éš›å‡½å¼åç¨±æ›¿æ›ä»¥ä¸‹å…§å®¹
async function refreshRightPanels(){
  try {
    if (typeof renderToday === 'function') await renderToday()
    if (typeof renderHistory === 'function') await renderHistory()
    console.log('[daily-report] å·²é‡æ–°æ•´ç†å³å´å…§å®¹')
  } catch(e){
    console.warn('[daily-report] ç„¡æ³•é‡æ–°æ•´ç†å³å´å…§å®¹ï¼š', e)
  }
}
</script>

</body>
</html>
