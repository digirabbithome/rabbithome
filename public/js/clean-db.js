// JS content trimmed for brevity, same as provided